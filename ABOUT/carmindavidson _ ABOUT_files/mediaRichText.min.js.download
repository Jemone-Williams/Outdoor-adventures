define("mediaRichText/bi/errors.json",[],function(){return{MEDIA_RICH_TEXT_WRONG_COMP_DATA:{errorCode:32e3,severity:"fatal",params:{p1:"wixCompJson",p2:"errorDesc",p3:"errorStack"}},MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT:{errorCode:32001,severity:"fatal",params:{p1:"wixCompJson"}},MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER:{errorCode:32002,severity:"fatal",params:{p1:"dataQuery"}}}}),define("mediaRichText/bi/errors",["mediaRichText/bi/errors.json","lodash","utils"],function(e,t,i){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),i.logger.register("mediaRichText","error",e),e}),define("mediaRichText/galleryHelpers/galleryHelpers",["lodash","utils"],function(e,t){"use strict";var i="wysiwyg.viewer.components.MatrixGallery",a="wysiwyg.viewer.skins.gallerymatrix.BlogMatrixGallery",n="wysiwyg.viewer.components.SlideShowGallery",o="skins.viewer.gallery.BlogSlideShow",r=[i,n],s=.75;function p(e){return e===i}function l(e){return e===n}function c(e,t){var i=e.width;return{width:i,height:function(e,t){var i=0;if(p(t.componentType)){var a=t.cols,n=t.rows,o=2*t.margin,r=Math.round((e-(a-1)*o)/a),c=s*r;i=Math.round(c*n)+(n-1)*o+26}else l(t.componentType)&&(i=Math.round(s*e));return i}(i,t),position:"relative"}}return{buildGalleryJsonFromCkData:function(i,n,r){var s=i.componentType,m=e.assign({dataQuery:i.dataQuery,propertyQuery:i.dataQuery,componentType:i.componentType,type:"Component",style:c(r,i),compData:{type:"ImageList",items:e.map(i.imageList,function(t){var i=e.get(n,t.dataQuery);return e.assign({},t,i,{type:"Image",id:t.id+t.uri,isRef:!1,metaData:{isHidden:!1,isPreset:!0,schemaVersion:"1.0"}})}),metaData:{isPreset:!0,schemaVersion:"1.0",isHidden:!1}}},function(e){var i={};return p(e.componentType)?i={skin:a,compProp:{type:"MatrixGalleryProperties",metaData:{schemaVersion:"1.0"},expandEnabled:!0,imageMode:e.fixedSize?"clipImage":"flexibleWidthFixed",numCols:e.cols,maxRows:e.rows,incRows:2,margin:2*e.margin,alignText:"left"}}:l(e.componentType)?i={skin:o,compProp:{autoplay:e.autoplay,autoplayInterval:e.autoplayInterval,bidirectional:!1,expandEnabled:!0,imageMode:"flexibleWidthFixed",metaData:{schemaVersion:"1.0"},reverse:!1,showAutoplay:!0,showCounter:!0,showExpand:!1,showNavigation:!0,showSocial:!1,transDuration:1,transition:"swipeHorizontal",type:"SlideShowGalleryProperties"}}:t.log.error("Unknown gallery type: "+e.componentType),i}(i));return l(s)&&(m.styleId=t.santaTypes.shortenStyleId(o)),p(s)&&(m.styleId=t.santaTypes.shortenStyleId(a)),m},isGalleryComponent:function(t){return e.includes(r,t)}}}),define("mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin",["lodash"],function(e){"use strict";return{getInitialState:function(){return{height:this.props.height}},onPlayerMessage:function(e){"resizeOfWixMusicIframe"===e.data.event&&e.data.playerId===this.props.playerId&&this.setState({height:e.data.size.maxHeight})},componentDidMount:function(){window.addEventListener("message",this.onPlayerMessage)},componentWillUnmount:function(){window.removeEventListener("message",this.onPlayerMessage)},getIframeProps:function(){return e.assign({},this.props,{height:this.state.height})}}}),define("mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector",["lodash","skins","core","utils"],function(e,t,i,a){"use strict";var n=t.skinsMap;i.styleCollector.registerClassBasedStyleCollector("wysiwyg.viewer.components.MediaRichText",function(e,t,i,o){for(var r=/(<img[^>]*wix-comp="([^"]+)"[^>]*>)/g,s=void 0;s=r.exec(e.dataItem.text);){var p=JSON.parse(s[2].replace(/&quot;/g,'"')),l="";p.skin&&n.get(p.skin)&&(l=p.skin),l&&!o[l]&&(o[a.santaTypes.shortenStyleId(l)]={skinName:e.structure.skin,componentType:e.structure.componentType})}})}),define("mediaRichText",["lodash","core","utils","coreUtils","compUtils","create-react-class","santaProps","textCommon","mediaRichText/bi/errors","mediaRichText/galleryHelpers/galleryHelpers","mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin","mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector"],function(e,t,i,a,n,o,r,s,p,l,c){"use strict";var m=o({displayName:"wixMusicEmbed",mixins:[c],render:function(){return t.createReactElement("iframe",g(this.getIframeProps()))}}),d=a.fragment,u=s.textComponentsUtils,h={wline:"div"};function y(e,t){try{return function(e,t){var i=JSON.parse(e.replace(/&quot;/g,'"'));return i.url=t,i}(e,t)}catch(t){return void this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_WRONG_COMP_DATA,{wixCompJson:e,errorDesc:t.message,errorStack:t.stack})}}function g(t){return e.assign(t,{wixComp:!0})}function f(t){return e.isFunction(t.type)&&t.props.wixComp}function w(e){return e.replace(/^#/,"")}function T(t){var i=this.props.siteData,a=this.props.id,n=function(t,i){var a=e.get(t,"structure.layout",{});return a.width&&(a.width=Math.min(i,a.width)),e.assign({},t.structure,{dataItem:t.compData,propertiesItem:t.compProp,layout:a,id:t.structure.id,type:t.structure.componentType,structure:t.structure})}(t,this._getMediaRichTextComponentWidth()),o=n.id;i.registerMediaRichTextInnerComponent(a,o,n)}var v={displayName:"MediaRichText",mixins:[s.textCompMixin],propTypes:{rootNavigationInfo:r.Types.Component.rootNavigationInfo.isRequired},allowIframes:!0,convertCompDataTextToHTML:function(t){this.componentDataQueryList=e.map(t.compData.componentDataList||[],w),this._compData=t.compData,this._componentHtml=this._componentHtml.replace(/\n|\r|\t/g,""),this._componentHtml=u.convertDataQueryLinksIntoHtmlAnchors(this._componentHtml,t.compData.linkList,e.partialRight(i.linkRenderer.renderLink,t.siteData,t.rootNavigationInfo)),this._componentHtml=u.mobileTextTransformIfNeeded(this._componentHtml,{brightness:e.get(t,"compProp.brightness"),isMobileView:t.siteData.isMobileView(),scale:e.get(t,"structure.layout.scale"),fontGetter:t.siteData.getFont.bind(t.siteData),colorGetter:t.siteData.getColor.bind(t.siteData)}),this.renderedDataQueries={},this._componentHtml=this._convertComponentsPlaceHoldersToRenderedComponents(this._componentHtml),e.size(this.renderedDataQueries)!==e.size(this.componentDataQueryList)&&e(this.componentDataQueryList).without(e.keys(this.renderedDataQueries)).forEach(function(e){this.props.siteAPI.reportBI(p.MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER,{dataQuery:"#"+e})}.bind(this)),this._registerReLayoutFunc=t.registerReLayout},_addToCompDataListIfMissing:function(t){var i=w(t);e.includes(this.componentDataQueryList,i)||this.componentDataQueryList.push(i)},_convertNodeFragmentToReactElements:function(i,a){if(i.nodeType===d.Node.ELEMENT_NODE){var n=e.reduce(i.attributes,function(t,i){return"style"===i.name?t.style=e.reduce(i.value.split(";"),function(t,i){var a=i.split(":");return 2===a.length&&(t[e.camelCase(a[0])]=a[1]),t},{}):"class"===i.name?t.className=i.value:"frameborder"===i.name?t.frameBorder=i.value:e.startsWith(i.name,"data-")?t[i.name]=i.value:t[e.camelCase(i.name)]=i.value,t},{});if(c=n.wixComp,m=i,c&&!e.has(h,m.tagName.toLowerCase())){var o=y.call(this,n.wixComp,n.src);return o?this._handleInnerComps(o,n):""}var r=(l=i,l.childNodes&&1===l.childNodes.length&&l.childNodes[0].nodeType===d.Node.TEXT_NODE?i.textContent:e.flatMap(i.childNodes,this._convertNodeFragmentToReactElements));if(e.isArray(r)&&r.length&&e.every(r,f))return r;var s=e.includes(this.voidElements,i.tagName.toLowerCase())?n:e.assign(n,{children:r});return t.createReactElement((p=i.tagName.toLowerCase(),h[p]||p),e.defaults(s,{key:""+i.tagName+a}))}var p,l,c,m;return i.nodeType===d.Node.TEXT_NODE?i.textContent:""},voidElements:["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],_convertComponentsPlaceHoldersToRenderedComponents:function(t){var i=d.document.createElement("div");return i.innerHTML=t,e.map(i.childNodes,this._convertNodeFragmentToReactElements)},_validateAndFixGalleryCompData:function(t,i){var a=e.clone(t),n=l.buildGalleryJsonFromCkData(i,this._compData.innerCompsData,t.style);return e.assign(a,n),function(t){var i=e.cloneDeep(t.compData);t.compData.items=e.map(t.compData.items,function(t){return e.assign({galleryData:i},t)})}(a),a},_createInnerComponentProperties:function(t,i){var a=this._createInnerComponentBasicProperties(t,i);if("wysiwyg.viewer.components.WPhoto"===i.componentType||"wysiwyg.viewer.components.Video"===i.componentType)return n=i,o=a,e.has(n,"post-cover-photo")&&(o.addItemProp=!0),o;if(l.isGalleryComponent(i.componentType))return this._validateAndFixGalleryCompData(a,i);var n,o;return this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT,{wixCompJson:i}),a},_getMediaRichTextComponentWidth:function(){return function(){var e=this.props.siteData.measureMap;return e&&(this._lastMeasuredWidth=e.width[this.props.id]),this._lastMeasuredWidth}.call(this)||e.get(this.props,"style.width")||630},_createInnerComponentBasicProperties:function(t,i){var a=function(t){var i,a=t.id||(i=t.dataQuery,"innerComp_"+i.replace("#",""));return e.assign(t,{id:a})}(i),n=e.get(this._compData.innerCompsData,a.dataQuery),o=void 0;if("wysiwyg.viewer.components.WPhoto"===a.componentType){if(a.linkDataQuery){var s=a.linkDataQuery.slice(1);n.link=e.find(this._compData.linkList,{id:s})}o={displayMode:"fitWidthStrict"}}else"wysiwyg.viewer.components.Video"===a.componentType&&(o={showControls:"temp_show",enablejsapi:1});var p=r.componentPropsBuilder.getCompProps(t,a,this.props.siteAPI,this.props.rootId,null,{compData:n,compProp:o});return p.key=p.key||i.key,delete p.ref,p.registerReLayout=this._registerReLayoutFunc||this.registerReLayout,function(e,t){var i=e.style;i.marginTop="10px",i.marginBottom="10px",i.marginLeft=t.marginLeft,i.marginRight=t.marginRight,i.position="static"}(p,a),function(e,t){var i=t.style;e.floatValue?(i.float=e.floatValue,i.display="",i.clear=""):(i.display=e.display,i.clear="both",i.float="")}(a,p),this._calcInnerCompWidthAndHeight(a,p),p},_calcInnerCompWidthAndHeight:function(t,i){var a=this._getMediaRichTextComponentWidth(),n=a,o=i.compData&&i.compData.width,r=t.width;e.isNumber(r)?n=this._getWidthMultiplier(t)*a:e.isNumber(o)&&(n=Math.min(o,a)),i.style.width=n,t.dimsRatio?i.style.height=i.style.width*t.dimsRatio:"wysiwyg.viewer.components.Video"===t.componentType&&(i.style.height=.5625*i.style.width)},_getWidthMultiplier:function(e){return this.props.siteData.isMobileView()?.99:e.width},_handleInnerComps:function(e,t){return"htmlComp"===e.componentType?this._handleHtmlComp(e,t):"music"===e.componentType?this._handleMusicComp(e,t):this._handleInnerSantaComponent(e)},_handleInnerSantaComponent:function(e){var t=n.compFactory.getCompReactClass(e.componentType),i=this._createInnerComponentProperties(t,e);this.renderedDataQueries[w(e.dataQuery)]=1,this._addToCompDataListIfMissing(e.dataQuery),T.call(this,i);return n.compFactory.getCompClass(e.componentType,!0)(g(i))},_handleHtmlComp:function(e,i){var a=this.props.siteData.serviceTopology.staticHTMLComponentUrl,n=void 0;if("website"===e.type)n="//"+(o=e.websiteUrl,o.replace(/^(https?:)?\/\//,""));else{n=("temp"===e.urlStatus?"//0.htmlcomponentservice.com/":a)+e.relativeUrl}var o;if("center"===e.align?i.style={display:"block",clear:"both",margin:"0 auto"}:i.style={float:e.align},i.src=n,i.sandbox="allow-scripts allow-same-origin allow-popups",this.props.siteData.isMobileView()&&e.dimsRatio){if(i.width="99%",e.dimsRatio>1){var r=.99*(this._getMediaRichTextComponentWidth()?parseInt(this._getMediaRichTextComponentWidth(),10):1)*e.dimsRatio;i.height=r}}else i.width=e.width;return t.createReactElement("iframe",g(i))},_handleMusicComp:function(i,a){var n=e.get(this.props.siteData,["serviceTopology","scriptsLocationMap","wix-music-embed"]),o=/^[\w\-]+$/i,r=o.test(i.paymentId)||""===i.paymentId;if(o.test(i.albumId)&&o.test(i.presetId)&&r)return a.src=n+"/index.html?albumId="+i.albumId+"&paymentsId="+i.paymentId+"&presetId="+i.presetId+"&playerId="+i.playerId+"&hideDetailedTrackInfo=true",this.props.siteData.isMobileView()&&(a.src+="&isMobile=true"),a.sandbox="allow-scripts allow-same-origin allow-popups",a.playerId=i.playerId,delete a.wixComp,a.width="100%",t.createReactElement(m,a)},componentWillUnmount:function(){this.props.siteData.clearMediaRichTextInnerComponents(this.props.id)}};return t.compRegistrar.register("wysiwyg.viewer.components.MediaRichText",v,!0),v});
//# sourceMappingURL=mediaRichText.min.js.map